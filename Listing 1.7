--Setze den Anwender-Mandanten in HANA
CREATE PROCEDURE "SET_USER_CLIENT" (in pCLIENT NVARCHAR(3))

LANGUAGE SQLSCRIPT SQL 
SECURITY INVOKER 

--Default-Schema "MY_SCHEMA"
AS
BEGIN
/***************************** 
Set Default Session Client = '002' to all available users 
 *****************************/
DECLARE LV_USER_COUNT integer;
DECLARE LV_SQL VARCHAR(299);
DECLARE LV_USER_NAME varchar(30);
DECLARE I Integer;
 
--Anzahl der Anwender/User für den Loop
SELECT COUNT(*) INTO LV_USER_COUNT FROM "SYS"."USERS";

--Auslesen aller User für die Bearbeitung
t1= select USER_NAME from "SYS"."USERS";
     --Loop von 1 bis Anzahl der User
       FOR i IN 0 .. :LV_USER_COUNT-1 DO  --Loop Beginn
         
           SELECT "USER_NAME"
           INTO LV_USER_NAME
           FROM :T1
           LIMIT 1 OFFSET :i; --Info: OFFSET-Indizes beginnen mit 0, nicht 1
--Aufbau des dynamischen SQLScript (siehe auch Kapitel 5 :) )
       LV_SQL := 'ALTER USER ' || LV_USER_NAME || ' SET PARAMETER "CLIENT" = ''' || pCLIENT || '''' ;
     --Update der User-Parameter des einzelnen Loop User via dynamischem EXEC SQL 
       EXEC (:LV_SQL); 
           
END FOR;  --Ende des Loop

END;
